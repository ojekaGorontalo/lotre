<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Bot Analytics Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: #333;
            font-size: 1rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-card .subtext {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            margin-bottom: 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f5f7ff;
        }
        
        .result-win {
            background-color: #d4edda;
            color: #155724;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .result-lose {
            background-color: #f8d7da;
            color: #721c24;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-width: 150px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 1.2rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .chart-container {
            height: 400px;
            margin-top: 30px;
        }
        
        .last-update {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .summary-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: left;
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ‚Äì WinGo Bot Analytics Dashboard</h1>
            <p>Real-time monitoring dan analisis data trading bot WinGo</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Taruhan</h3>
                <div class="value" id="totalBets">0</div>
                <div class="subtext">Sejak bot mulai berjalan</div>
            </div>
            
            <div class="stat-card">
                <h3>Win Rate</h3>
                <div class="value" id="winRate">0%</div>
                <div class="subtext">Persentase kemenangan</div>
            </div>
            
            <div class="stat-card">
                <h3>Total Reset</h3>
                <div class="value" id="totalResets">0</div>
                <div class="subtext">Reset saldo otomatis</div>
            </div>
            
            <div class="stat-card">
                <h3>Profit/Loss</h3>
                <div class="value" id="totalProfit">Rp 0</div>
                <div class="subtext">Total laba/rugi</div>
            </div>
        </div>
        
        <div class="summary">
            <div class="summary-item">
                <div class="summary-value" id="totalWins">0</div>
                <div class="summary-label">Kemenangan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="totalLosses">0</div>
                <div class="summary-label">Kekalahan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="currentStreak">0</div>
                <div class="summary-label">Streak Saat Ini</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="avgBetAmount">Rp 0</div>
                <div class="summary-label">Rata-rata Taruhan</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="filters">
                <input type="date" id="dateFilter" class="filter-input">
                <input type="text" id="searchFilter" class="filter-input" placeholder="Cari...">
                <button class="btn" onclick="refreshData()">ü§ñ‚Äù‚Äû Refresh</button>
            </div>
            <div>
                <span id="connectionStatus" class="result-win">√¢‚Äî¬è Terhubung</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'results')">ü§ñ‚Äú≈† Hasil Taruhan</button>
            <button class="tab" onclick="openTab(event, 'resets')">ü§ñ‚Äù‚Äû Data Reset</button>
            <button class="tab" onclick="openTab(event, 'reports')">ü§ñ‚Äú‚Ä¶ Laporan Harian</button>
            <button class="tab" onclick="openTab(event, 'safety')">√¢≈°¬†√Ø¬∏¬è Safety Events</button>
            <button class="tab" onclick="openTab(event, 'balance')">ü§ñ‚Äô¬∞ Perubahan Saldo</button>
        </div>
        
        <div id="results" class="tab-content active">
            <h2>√∞≈∏‚Äú≈† Data Hasil Taruhan</h2>
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Periode</th>
                            <th>Angka</th>
                            <th>Hasil</th>
                            <th>Prediksi</th>
                            <th>Status</th>
                            <th>Level</th>
                            <th>Taruhan</th>
                            <th>Profit/Loss</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResults">Memuat data hasil taruhan...</div>
            <div class="empty-state" id="emptyResults" style="display: none;">
                <div>√∞≈∏‚Äú¬≠</div>
                <p>Tidak ada data hasil taruhan</p>
            </div>
        </div>
        
        <div id="resets" class="tab-content">
            <h2>√∞≈∏‚Äù‚Äû Data Reset Saldo</h2>
            <div class="table-container">
                <table id="resetsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Alasan</th>
                            <th>Saldo Lama</th>
                            <th>Saldo Baru</th>
                            <th>Total Bet</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="resetsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResets">Memuat data reset...</div>
            <div class="empty-state" id="emptyResets" style="display: none;">
                <div>√∞≈∏‚Äú¬≠</div>
                <p>Tidak ada data reset</p>
            </div>
        </div>
        
        <div id="reports" class="tab-content">
            <h2>√∞≈∏‚Äú‚Ä¶ Laporan Harian</h2>
            <div class="table-container">
                <table id="reportsTable">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Total Taruhan</th>
                            <th>Menang</th>
                            <th>Kalah</th>
                            <th>Win Rate</th>
                            <th>Profit/Loss</th>
                            <th>Saldo Akhir</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="reportsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingReports">Memuat laporan harian...</div>
            <div class="empty-state" id="emptyReports" style="display: none;">
                <div>√∞≈∏‚Äú¬≠</div>
                <p>Tidak ada laporan harian</p>
            </div>
        </div>
        
        <div id="safety" class="tab-content">
            <h2>√¢≈°¬†√Ø¬∏¬è Safety Events</h2>
            <div class="table-container">
                <table id="safetyTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Event</th>
                            <th>Detail</th>
                            <th>Saldo</th>
                            <th>Kalah Berturut</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="safetyBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingSafety">Memuat safety events...</div>
            <div class="empty-state" id="emptySafety" style="display: none;">
                <div>√∞≈∏‚Äú¬≠</div>
                <p>Tidak ada safety events</p>
            </div>
        </div>
        
        <div id="balance" class="tab-content">
            <h2>√∞≈∏‚Äô¬∞ Perubahan Saldo</h2>
            <div class="table-container">
                <table id="balanceTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Saldo Baru</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="balanceBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingBalance">Memuat perubahan saldo...</div>
            <div class="empty-state" id="emptyBalance" style="display: none;">
                <div>√∞≈∏‚Äú¬≠</div>
                <p>Tidak ada perubahan saldo</p>
            </div>
        </div>
        
        <div class="last-update">
            Terakhir diperbarui: <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwepdohDnAFm7j9yGZ3Wan5etfMlYIY4w",
            authDomain: "wingo-bot-analytics.firebaseapp.com",
            databaseURL: "https://wingo-bot-analytics-default-rtdb.firebaseio.com",
            projectId: "wingo-bot-analytics",
            storageBucket: "wingo-bot-analytics.appspot.com",
            messagingSenderId: "46011860748",
            appId: "1:46011860748:web:f5d61b92de5201a6ed818e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let allResults = [];
        let allResets = [];
        let allReports = [];
        let allSafetyEvents = [];
        let allBalanceChanges = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // Auto refresh every 30 seconds
            setInterval(loadAllData, 30000);
        });

        // Load all data from Firebase
        function loadAllData() {
            console.log('Memuat data dari Firebase...');
            
            // Load results
            database.ref('results').orderByChild('timestamp').limitToLast(1500).on('value', (snapshot) => {
                allResults = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResults.unshift(data); // Newest first
                });
                displayResults();
                updateStats();
            }, (error) => {
                console.error('Error loading results:', error);
            });

            // Load resets
            database.ref('resets').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allResets = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResets.unshift(data);
                });
                displayResets();
                updateStats();
            });

            // Load reports
            database.ref('daily_reports').orderByChild('timestamp').limitToLast(30).on('value', (snapshot) => {
                allReports = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allReports.unshift(data);
                });
                displayReports();
            });

            // Load safety events
            database.ref('safety_events').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allSafetyEvents = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allSafetyEvents.unshift(data);
                });
                displaySafetyEvents();
            });

            // Load balance changes
            database.ref('balance_changes').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allBalanceChanges = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allBalanceChanges.unshift(data);
                });
                displayBalanceChanges();
            });

            // Update last update time
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('id-ID');
            document.getElementById('connectionStatus').textContent = '√¢‚Äî¬è Terhubung';
            document.getElementById('connectionStatus').className = 'result-win';
        }

        // Display results in table
        function displayResults() {
            const tbody = document.getElementById('resultsBody');
            const loading = document.getElementById('loadingResults');
            const empty = document.getElementById('emptyResults');
            
            if (allResults.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            let html = '';
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            
            allResults.forEach(result => {
                const resultDate = new Date(result.timestamp).toISOString().split('T')[0];
                const resultTime = new Date(result.timestamp).toLocaleTimeString('id-ID');
                
                // Apply filters
                if (dateFilter && resultDate !== dateFilter) return;
                if (searchTerm) {
                    const searchText = `${result.result} ${result.prediction} ${result.issue}`.toLowerCase();
                    if (!searchText.includes(searchTerm)) return;
                }
                
                const isWin = result.isWin;
                const statusClass = isWin ? 'result-win' : 'result-lose';
                const statusText = isWin ? 'MENANG' : 'KALAH';
                
                // Tampilkan profitLoss langsung dari Firebase
                const profitLoss = result.profitLoss || 0;
                
                html += `
                <tr>
                    <td>${resultTime}</td>
                    <td>${result.issue || '-'}</td>
                    <td><strong>${result.number || '-'}</strong></td>
                    <td>${result.result || '-'}</td>
                    <td>${result.prediction || '-'}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${result.betLevel || '-'}</td>
                    <td>Rp ${formatNumber(result.betAmount || 0)}</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(result.virtualBalance || 0)}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = html ? 'none' : 'block';
        }

        // Display resets in table
        function displayResets() {
            const tbody = document.getElementById('resetsBody');
            const loading = document.getElementById('loadingResets');
            const empty = document.getElementById('emptyResets');
            
            if (allResets.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            let html = '';
            
            allResets.forEach(reset => {
                const resetTime = new Date(reset.timestamp || reset.resetTime).toLocaleString('id-ID');
                
                html += `
                <tr>
                    <td>${resetTime}</td>
                    <td>${reset.reason || 'Tidak diketahui'}</td>
                    <td>Rp ${formatNumber(reset.oldBalance || 0)}</td>
                    <td>Rp ${formatNumber(reset.newBalance || 0)}</td>
                    <td>${reset.totalBetsBeforeReset || 0}</td>
                    <td>${reset.currentBetIndex + 1 || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display reports in table
        function displayReports() {
            const tbody = document.getElementById('reportsBody');
            const loading = document.getElementById('loadingReports');
            const empty = document.getElementById('emptyReports');
            
            if (allReports.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            let html = '';
            
            allReports.forEach(report => {
                const reportDate = new Date(report.date || report.timestamp).toLocaleDateString('id-ID');
                const winRate = report.winRate || (report.totalWins && report.totalBets ? 
                    Math.round((report.totalWins / report.totalBets) * 100) : 0);
                
                // Tampilkan profitLoss langsung dari Firebase
                const profitLoss = report.profitLoss || 0;
                
                html += `
                <tr>
                    <td>${reportDate}</td>
                    <td>${report.totalBets || 0}</td>
                    <td>${report.totalWins || 0}</td>
                    <td>${report.totalLosses || 0}</td>
                    <td>${winRate}%</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(report.virtualBalance || 0)}</td>
                    <td>${report.currentBetLevel || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display safety events in table
        function displaySafetyEvents() {
            const tbody = document.getElementById('safetyBody');
            const loading = document.getElementById('loadingSafety');
            const empty = document.getElementById('emptySafety');
            
            if (allSafetyEvents.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            let html = '';
            
            allSafetyEvents.forEach(event => {
                const eventTime = new Date(event.timestamp).toLocaleString('id-ID');
                const details = event.details ? JSON.stringify(event.details) : '-';
                
                html += `
                <tr>
                    <td>${eventTime}</td>
                    <td>${event.event || '-'}</td>
                    <td title="${details}">${truncateText(details, 50)}</td>
                    <td>Rp ${formatNumber(event.virtualBalance || 0)}</td>
                    <td>${event.losingStreak || 0}</td>
                    <td>${event.currentBetLevel || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display balance changes in table
        function displayBalanceChanges() {
            const tbody = document.getElementById('balanceBody');
            const loading = document.getElementById('loadingBalance');
            const empty = document.getElementById('emptyBalance');
            
            if (allBalanceChanges.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            let html = '';
            
            allBalanceChanges.forEach(change => {
                const changeTime = new Date(change.timestamp).toLocaleString('id-ID');
                const type = change.type === 'manual_add_balance' ? 'Tambah Manual' : 
                            change.type === 'reset' ? 'Reset' : 'Lainnya';
                
                html += `
                <tr>
                    <td>${changeTime}</td>
                    <td>${type}</td>
                    <td>Rp ${formatNumber(change.amount || 0)}</td>
                    <td>Rp ${formatNumber(change.newBalance || 0)}</td>
                    <td>${change.reason || '-'}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Update statistics - MODIFIED: Ambil profitLoss langsung dari Firebase
        function updateStats() {
            if (allResults.length === 0) return;
            
            // Total bets
            document.getElementById('totalBets').textContent = allResults.length;
            
            // Calculate wins and losses
            const wins = allResults.filter(r => r.isWin).length;
            const losses = allResults.filter(r => !r.isWin).length;
            const winRate = allResults.length > 0 ? Math.round((wins / allResults.length) * 100) : 0;
            
            document.getElementById('totalWins').textContent = wins;
            document.getElementById('totalLosses').textContent = losses;
            document.getElementById('winRate').textContent = winRate + '%';
            
            // Total resets
            document.getElementById('totalResets').textContent = allResets.length;
            
            // === PERUBAHAN PENTING ===
            // Ambil total profit/loss langsung dari Firebase
            let totalProfit = 0;
            
            // Opsi 1: Ambil dari laporan harian (jika ada)
            if (allReports.length > 0) {
                // Ambil dari laporan harian terakhir
                totalProfit = allReports[0].profitLoss || 0;
            } 
            // Opsi 2: Ambil dari hasil taruhan terakhir (fallback)
            else if (allResults.length > 0) {
                totalProfit = allResults[0].profitLoss || 0;
            }
            
            document.getElementById('totalProfit').textContent = 'Rp ' + formatNumber(totalProfit);
            // ==========================
            
            // Current streak (from latest result)
            const latestResult = allResults[0];
            if (latestResult) {
                document.getElementById('currentStreak').textContent = latestResult.currentStreak || 0;
            }
            
            // Average bet amount
            const totalBetAmount = allResults.reduce((sum, result) => sum + (result.betAmount || 0), 0);
            const avgBetAmount = allResults.length > 0 ? Math.round(totalBetAmount / allResults.length) : 0;
            document.getElementById('avgBetAmount').textContent = 'Rp ' + formatNumber(avgBetAmount);
        }

        // Tab switching function
        function openTab(evt, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show current tab and add active class
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // Format number with thousand separators
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Truncate text
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Refresh data
        function refreshData() {
            console.log('Manual refresh...');
            document.getElementById('connectionStatus').textContent = '√¢‚Äî¬è Memuat ulang...';
            document.getElementById('connectionStatus').className = '';
            
            // Show loading states
            const loadings = document.querySelectorAll('.loading');
            loadings.forEach(loading => {
                loading.style.display = 'block';
            });
            
            const empties = document.querySelectorAll('.empty-state');
            empties.forEach(empty => {
                empty.style.display = 'none';
            });
            
            // Reload data after a short delay
            setTimeout(() => {
                loadAllData();
            }, 500);
        }

        // Add event listeners for filters
        document.getElementById('dateFilter').addEventListener('change', function() {
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        document.getElementById('searchFilter').addEventListener('input', function() {
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        // Add keyboard shortcut for refresh (Ctrl+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
        });
    </script>
</body>
</html>
