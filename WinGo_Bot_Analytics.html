<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Bot Analytics Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 30px 20px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3);
            border: none;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 30px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(220, 38, 38, 0.15);
            border-color: #dc2626;
        }
        
        .stat-card h3 {
            color: #555;
            font-size: 1rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-card .value {
            font-size: 2.8rem;
            font-weight: bold;
            color: #dc2626;
            line-height: 1;
            margin-bottom: 10px;
        }
        
        .stat-card .subtext {
            color: #777;
            font-size: 0.95rem;
            margin-top: 8px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            margin-bottom: 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
            border-bottom: none;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 18px 25px;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 200px;
        }
        
        .tab:hover {
            background: #f1f3f5;
        }
        
        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
            border-top: none;
            min-height: 400px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border-radius: 10px;
            border: 1px solid #eee;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            min-width: 1000px;
        }
        
        th {
            background: #dc2626;
            color: white;
            padding: 18px 15px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }
        
        tr:hover {
            background: #fef2f2;
        }
        
        .result-win {
            background-color: #dcfce7;
            color: #166534;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            border: 1px solid #bbf7d0;
            display: inline-block;
        }
        
        .result-lose {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            border: 1px solid #fecaca;
            display: inline-block;
        }
        
        .btn {
            padding: 12px 25px;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-input {
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            min-width: 180px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #e5e7eb;
            margin-bottom: 20px;
            display: block;
        }
        
        .chart-container {
            height: 400px;
            margin-top: 30px;
        }
        
        .last-update {
            text-align: right;
            color: #666;
            font-size: 0.95rem;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-item {
            background: white;
            padding: 25px 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .summary-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .summary-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #dc2626;
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .summary-label {
            font-size: 0.95rem;
            color: #666;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .status-connected {
            background-color: #dcfce7;
            color: #166534;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #bbf7d0;
        }
        
        .status-disconnected {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #fecaca;
        }
        
        .bot-icon {
            font-size: 1.8rem;
        }
        
        .tab-icon {
            font-size: 1.2rem;
        }
        
        h2 {
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* Style untuk colour dots */
        .colour-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .colour-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .colour-red {
            background-color: #ff4444;
        }
        
        .colour-green {
            background-color: #44ff44;
        }
        
        .colour-violet {
            background-color: #aa44ff;
        }
        
        .colour-blue {
            background-color: #4444ff;
        }
        
        .colour-yellow {
            background-color: #ffff44;
        }
        
        .colour-orange {
            background-color: #ffaa44;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: left;
                padding: 20px;
                min-width: 100%;
                justify-content: flex-start;
            }
            
            .controls {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-input {
                width: 100%;
                min-width: auto;
            }
            
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .tab-content {
                padding: 20px 15px;
            }
            
            .stat-card .value {
                font-size: 2.2rem;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .last-update {
                text-align: center;
            }
            
            .colour-dots {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 25px 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .stat-card {
                padding: 25px 20px;
            }
            
            .summary {
                grid-template-columns: 1fr 1fr;
            }
            
            .summary-item {
                padding: 20px 15px;
            }
            
            .summary-value {
                font-size: 1.8rem;
            }
            
            .colour-dot {
                width: 12px;
                height: 12px;
            }
        }
        
        /* Scrollbar styling */
        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #dc2626;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="bot-icon">üìä</span> WinGo Bot Analytics Dashboard</h1>
            <p>Real-time monitoring dan analisis data trading bot WinGo</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3><span>üéØ</span> Total Taruhan</h3>
                <div class="value" id="totalBets">0</div>
                <div class="subtext">Sejak bot mulai berjalan</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üìà</span> Win Rate</h3>
                <div class="value" id="winRate">0%</div>
                <div class="subtext">Persentase kemenangan</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üîÑ</span> Total Reset</h3>
                <div class="value" id="totalResets">0</div>
                <div class="subtext">Reset saldo otomatis</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üí∞</span> Profit/Loss</h3>
                <div class="value" id="totalProfit">Rp 0</div>
                <div class="subtext">Total laba/rugi</div>
            </div>
        </div>
        
        <div class="summary">
            <div class="summary-item">
                <div class="summary-value" id="totalWins">0</div>
                <div class="summary-label">Kemenangan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="totalLosses">0</div>
                <div class="summary-label">Kekalahan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="currentStreak">0</div>
                <div class="summary-label">Streak Saat Ini</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="avgBetAmount">Rp 0</div>
                <div class="summary-label">Rata-rata Taruhan</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="filters">
                <input type="date" id="dateFilter" class="filter-input">
                <input type="text" id="searchFilter" class="filter-input" placeholder="Cari...">
                <button class="btn" onclick="refreshData()"><span>üîÑ</span> Refresh Data</button>
            </div>
            <div>
                <span id="connectionStatus" class="status-connected"><span>‚úÖ</span> Terhubung ke Database</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'results')"><span class="tab-icon">üìä</span> Hasil Taruhan</button>
            <button class="tab" onclick="openTab(event, 'resets')"><span class="tab-icon">üîÑ</span> Data Reset</button>
            <button class="tab" onclick="openTab(event, 'reports')"><span class="tab-icon">üìã</span> Laporan Harian</button>
            <button class="tab" onclick="openTab(event, 'safety')"><span class="tab-icon">‚ö†Ô∏è</span> Safety Events</button>
            <button class="tab" onclick="openTab(event, 'balance')"><span class="tab-icon">üí∞</span> Perubahan Saldo</button>
        </div>
        
        <div id="results" class="tab-content active">
            <h2><span>üìä</span> Data Hasil Taruhan</h2>
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Periode</th>
                            <th>Angka</th>
                            <th>Colour</th>
                            <th>Hasil</th>
                            <th>Prediksi</th>
                            <th>Status</th>
                            <th>Level</th>
                            <th>Taruhan</th>
                            <th>P/L</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResults">Memuat data hasil taruhan...</div>
            <div class="empty-state" id="emptyResults" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada data hasil taruhan</p>
            </div>
        </div>
        
        <div id="resets" class="tab-content">
            <h2><span>üîÑ</span> Data Reset Saldo</h2>
            <div class="table-container">
                <table id="resetsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Alasan</th>
                            <th>Saldo Lama</th>
                            <th>Saldo Baru</th>
                            <th>Total Bet</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="resetsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResets">Memuat data reset...</div>
            <div class="empty-state" id="emptyResets" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada data reset</p>
            </div>
        </div>
        
        <div id="reports" class="tab-content">
            <h2><span>üìã</span> Laporan Harian</h2>
            <div class="table-container">
                <table id="reportsTable">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Total Taruhan</th>
                            <th>Menang</th>
                            <th>Kalah</th>
                            <th>Win Rate</th>
                            <th>Profit/Loss</th>
                            <th>Saldo Akhir</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="reportsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingReports">Memuat laporan harian...</div>
            <div class="empty-state" id="emptyReports" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada laporan harian</p>
            </div>
        </div>
        
        <div id="safety" class="tab-content">
            <h2><span>‚ö†Ô∏è</span> Safety Events</h2>
            <div class="table-container">
                <table id="safetyTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Event</th>
                            <th>Detail</th>
                            <th>Saldo</th>
                            <th>Kalah Berturut</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="safetyBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingSafety">Memuat safety events...</div>
            <div class="empty-state" id="emptySafety" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada safety events</p>
            </div>
        </div>
        
        <div id="balance" class="tab-content">
            <h2><span>üí∞</span> Perubahan Saldo</h2>
            <div class="table-container">
                <table id="balanceTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Saldo Baru</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="balanceBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingBalance">Memuat perubahan saldo...</div>
            <div class="empty-state" id="emptyBalance" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada perubahan saldo</p>
            </div>
        </div>
        
        <div class="last-update">
            <strong>Terakhir diperbarui:</strong> <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwepdohDnAFm7j9yGZ3Wan5etfMlYIY4w",
            authDomain: "wingo-bot-analytics.firebaseapp.com",
            databaseURL: "https://wingo-bot-analytics-default-rtdb.firebaseio.com",
            projectId: "wingo-bot-analytics",
            storageBucket: "wingo-bot-analytics.appspot.com",
            messagingSenderId: "46011860748",
            appId: "1:46011860748:web:f5d61b92de5201a6ed818e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let allResults = [];
        let allResets = [];
        let allReports = [];
        let allSafetyEvents = [];
        let allBalanceChanges = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // Auto refresh every 30 seconds
            setInterval(loadAllData, 30000);
        });

        // Load all data from Firebase
        function loadAllData() {
            console.log('Memuat data dari Firebase...');
            
            // Load results
            database.ref('results').orderByChild('timestamp').limitToLast(1000).on('value', (snapshot) => {
                allResults = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResults.unshift(data); // Newest first
                });
                displayResults();
                updateStats();
            }, (error) => {
                console.error('Error loading results:', error);
                showConnectionError();
            });

            // Load resets
            database.ref('resets').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allResets = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResets.unshift(data);
                });
                displayResets();
                updateStats();
            }, (error) => {
                console.error('Error loading resets:', error);
                showConnectionError();
            });

            // Load reports
            database.ref('daily_reports').orderByChild('timestamp').limitToLast(30).on('value', (snapshot) => {
                allReports = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allReports.unshift(data);
                });
                displayReports();
            }, (error) => {
                console.error('Error loading reports:', error);
                showConnectionError();
            });

            // Load safety events
            database.ref('safety_events').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allSafetyEvents = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allSafetyEvents.unshift(data);
                });
                displaySafetyEvents();
            }, (error) => {
                console.error('Error loading safety events:', error);
                showConnectionError();
            });

            // Load balance changes
            database.ref('balance_changes').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allBalanceChanges = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allBalanceChanges.unshift(data);
                });
                displayBalanceChanges();
            }, (error) => {
                console.error('Error loading balance changes:', error);
                showConnectionError();
            });

            // Update last update time
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('id-ID');
            document.getElementById('connectionStatus').innerHTML = '<span>‚úÖ</span> Terhubung ke Database';
            document.getElementById('connectionStatus').className = 'status-connected';
        }

        // Fungsi untuk render colour dots
        function renderColourDots(colourStr) {
            if (!colourStr) return '-';
            
            const colours = colourStr.split(',').map(c => c.trim().toLowerCase());
            let html = '<div class="colour-dots">';
            
            colours.forEach(colour => {
                let colourClass = 'colour-' + colour;
                // Pastikan hanya warna yang valid
                const validColours = ['red', 'green', 'violet', 'blue', 'yellow', 'orange'];
                if (!validColours.includes(colour)) {
                    colourClass = 'colour-blue'; // Default jika warna tidak dikenal
                }
                html += `<div class="colour-dot ${colourClass}" title="${colour}"></div>`;
            });
            
            html += '</div>';
            return html;
        }

        // Display results in table
        function displayResults() {
            const tbody = document.getElementById('resultsBody');
            const loading = document.getElementById('loadingResults');
            const empty = document.getElementById('emptyResults');
            
            if (allResults.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            
            // Counter untuk membatasi jumlah baris yang ditampilkan
            let displayedRows = 0;
            const maxRows = 500; // Maksimum baris yang ditampilkan
            
            allResults.forEach(result => {
                if (displayedRows >= maxRows) return;
                
                const resultDate = new Date(result.timestamp).toISOString().split('T')[0];
                const resultTime = new Date(result.timestamp).toLocaleTimeString('id-ID');
                
                // Apply filters
                if (dateFilter && resultDate !== dateFilter) return;
                if (searchTerm) {
                    const searchText = `${result.result || ''} ${result.prediction || ''} ${result.issue || ''} ${result.colour || ''}`.toLowerCase();
                    if (!searchText.includes(searchTerm)) return;
                }
                
                const isWin = result.isWin;
                const statusClass = isWin ? 'result-win' : 'result-lose';
                const statusText = isWin ? 'MENANG' : 'KALAH';
                
                const profitLoss = result.profitLoss || 0;
                
                // Render colour dots
                const colourDots = renderColourDots(result.colour);
                
                html += `
                <tr>
                    <td>${resultTime}</td>
                    <td>${result.issue || '-'}</td>
                    <td><strong>${result.number !== undefined && result.number !== null ? result.number : '-'}</strong></td>
                    <td>${colourDots}</td>
                    <td>${result.result || '-'}</td>
                    <td>${result.prediction || '-'}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${result.betLevel || '-'}</td>
                    <td>Rp ${formatNumber(result.betAmount || 0)}</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(result.virtualBalance || 0)}</td>
                </tr>
                `;
                
                displayedRows++;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = html ? 'none' : 'block';
        }

        // Display resets in table
        function displayResets() {
            const tbody = document.getElementById('resetsBody');
            const loading = document.getElementById('loadingResets');
            const empty = document.getElementById('emptyResets');
            
            if (allResets.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allResets.forEach(reset => {
                const resetTime = new Date(reset.timestamp || reset.resetTime).toLocaleString('id-ID');
                
                html += `
                <tr>
                    <td>${resetTime}</td>
                    <td>${reset.reason || 'Tidak diketahui'}</td>
                    <td>Rp ${formatNumber(reset.oldBalance || 0)}</td>
                    <td>Rp ${formatNumber(reset.newBalance || 0)}</td>
                    <td>${reset.totalBetsBeforeReset || 0}</td>
                    <td>${reset.currentBetIndex + 1 || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display reports in table
        function displayReports() {
            const tbody = document.getElementById('reportsBody');
            const loading = document.getElementById('loadingReports');
            const empty = document.getElementById('emptyReports');
            
            if (allReports.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allReports.forEach(report => {
                const reportDate = new Date(report.date || report.timestamp).toLocaleDateString('id-ID');
                const winRate = report.winRate || (report.totalWins && report.totalBets ? 
                    Math.round((report.totalWins / report.totalBets) * 100) : 0);
                
                const profitLoss = report.profitLoss || 0;
                
                html += `
                <tr>
                    <td>${reportDate}</td>
                    <td>${report.totalBets || 0}</td>
                    <td>${report.totalWins || 0}</td>
                    <td>${report.totalLosses || 0}</td>
                    <td>${winRate}%</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(report.virtualBalance || 0)}</td>
                    <td>${report.currentBetLevel || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display safety events in table
        function displaySafetyEvents() {
            const tbody = document.getElementById('safetyBody');
            const loading = document.getElementById('loadingSafety');
            const empty = document.getElementById('emptySafety');
            
            if (allSafetyEvents.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allSafetyEvents.forEach(event => {
                const eventTime = new Date(event.timestamp).toLocaleString('id-ID');
                const details = event.details ? JSON.stringify(event.details) : '-';
                
                html += `
                <tr>
                    <td>${eventTime}</td>
                    <td>${event.event || '-'}</td>
                    <td title="${details}">${truncateText(details, 50)}</td>
                    <td>Rp ${formatNumber(event.virtualBalance || 0)}</td>
                    <td>${event.losingStreak || 0}</td>
                    <td>${event.currentBetLevel || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display balance changes in table
        function displayBalanceChanges() {
            const tbody = document.getElementById('balanceBody');
            const loading = document.getElementById('loadingBalance');
            const empty = document.getElementById('emptyBalance');
            
            if (allBalanceChanges.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allBalanceChanges.forEach(change => {
                const changeTime = new Date(change.timestamp).toLocaleString('id-ID');
                const type = change.type === 'manual_add_balance' ? 'Tambah Manual' : 
                            change.type === 'reset' ? 'Reset' : 
                            change.type === 'bet' ? 'Taruhan' :
                            change.type === 'win' ? 'Menang' :
                            change.type === 'loss' ? 'Kalah' : 'Lainnya';
                
                html += `
                <tr>
                    <td>${changeTime}</td>
                    <td>${type}</td>
                    <td>Rp ${formatNumber(change.amount || 0)}</td>
                    <td>Rp ${formatNumber(change.newBalance || 0)}</td>
                    <td>${change.reason || '-'}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Update statistics
        function updateStats() {
            if (allResults.length === 0) {
                // Set default values
                document.getElementById('totalBets').textContent = '0';
                document.getElementById('totalWins').textContent = '0';
                document.getElementById('totalLosses').textContent = '0';
                document.getElementById('winRate').textContent = '0%';
                document.getElementById('totalResets').textContent = allResets.length;
                document.getElementById('totalProfit').textContent = 'Rp 0';
                document.getElementById('currentStreak').textContent = '0';
                document.getElementById('avgBetAmount').textContent = 'Rp 0';
                return;
            }
            
            // Total bets
            document.getElementById('totalBets').textContent = allResults.length;
            
            // Calculate wins and losses
            const wins = allResults.filter(r => r.isWin).length;
            const losses = allResults.filter(r => !r.isWin).length;
            const winRate = allResults.length > 0 ? Math.round((wins / allResults.length) * 100) : 0;
            
            document.getElementById('totalWins').textContent = wins;
            document.getElementById('totalLosses').textContent = losses;
            document.getElementById('winRate').textContent = winRate + '%';
            
            // Total resets
            document.getElementById('totalResets').textContent = allResets.length;
            
            // Calculate total profit/loss from all results
            let totalProfit = 0;
            allResults.forEach(result => {
                totalProfit += (result.profitLoss || 0);
            });
            
            document.getElementById('totalProfit').textContent = 'Rp ' + formatNumber(totalProfit);
            
            // Current streak (from latest result)
            const latestResult = allResults[0];
            if (latestResult) {
                document.getElementById('currentStreak').textContent = latestResult.currentStreak || 0;
            }
            
            // Average bet amount
            const totalBetAmount = allResults.reduce((sum, result) => sum + (result.betAmount || 0), 0);
            const avgBetAmount = allResults.length > 0 ? Math.round(totalBetAmount / allResults.length) : 0;
            document.getElementById('avgBetAmount').textContent = 'Rp ' + formatNumber(avgBetAmount);
        }

        // Tab switching function
        function openTab(evt, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show current tab and add active class
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // Format number with thousand separators
        function formatNumber(num) {
            if (num === undefined || num === null) return "0";
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Truncate text
        function truncateText(text, maxLength) {
            if (!text || text === '-') return '-';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Refresh data
        function refreshData() {
            console.log('Manual refresh...');
            document.getElementById('connectionStatus').innerHTML = '<span>üîÑ</span> Memuat ulang...';
            document.getElementById('connectionStatus').className = 'status-disconnected';
            
            // Show loading states
            const loadings = document.querySelectorAll('.loading');
            loadings.forEach(loading => {
                loading.style.display = 'block';
            });
            
            const empties = document.querySelectorAll('.empty-state');
            empties.forEach(empty => {
                empty.style.display = 'none';
            });
            
            // Reload data after a short delay
            setTimeout(() => {
                loadAllData();
            }, 500);
        }

        // Show connection error
        function showConnectionError() {
            document.getElementById('connectionStatus').innerHTML = '<span>‚ùå</span> Gagal menghubungi database';
            document.getElementById('connectionStatus').className = 'status-disconnected';
        }

        // Add event listeners for filters
        document.getElementById('dateFilter').addEventListener('change', function() {
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        document.getElementById('searchFilter').addEventListener('input', function() {
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        // Add keyboard shortcut for refresh (Ctrl+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
        });

        // Set today's date as default in date filter
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFilter').value = today;
        };
    </script>
</body>
</html>
