<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WinGo Bot Analytics Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* MOBILE FIRST - Default untuk HP (360px-480px) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #f8f9fa;
            min-height: 100vh;
            padding: 12px;
            font-size: 14px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* HEADER - Mobile */
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px 15px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            border: none;
        }
        
        .header h1 {
            font-size: 1.4rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            line-height: 1.3;
        }
        
        .header p {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 300;
            line-height: 1.4;
        }
        
        /* STATS GRID - Mobile 2 kolom */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 18px 15px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 110px;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(220, 38, 38, 0.15);
            border-color: #dc2626;
        }
        
        .stat-card h3 {
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-card .value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #dc2626;
            line-height: 1;
            margin-bottom: 4px;
            word-break: break-word;
        }
        
        .stat-card .subtext {
            color: #777;
            font-size: 0.8rem;
            margin-top: 4px;
        }
        
        /* SUMMARY - Mobile 2 kolom */
        .summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .summary-item {
            background: white;
            padding: 16px 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        
        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc2626;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 3px;
            font-weight: 500;
        }
        
        /* CONTROLS - Mobile vertikal */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            padding: 18px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
        }
        
        .filters {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        
        .filter-input {
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            width: 100%;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.1);
        }
        
        .btn {
            padding: 14px;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .btn:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(220, 38, 38, 0.3);
        }
        
        #connectionStatus {
            align-self: center;
            text-align: center;
            width: 100%;
        }
        
        .status-connected {
            background-color: #dcfce7;
            color: #166534;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid #bbf7d0;
            font-size: 0.9rem;
            width: auto;
        }
        
        .status-disconnected {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid #fecaca;
            font-size: 0.9rem;
            width: auto;
        }
        
        /* PAGINATION STYLES */
        .pagination-controls {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-bottom: 15px;
        }
        
        .pagination-btn {
            padding: 8px 16px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: #4b5563;
            font-weight: 500;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
            transform: translateY(-1px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f3f4f6;
            color: #9ca3af;
        }
        
        #pageInfo {
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            min-width: 90px;
            text-align: center;
        }
        
        /* TABS - Horizontal scroll di mobile */
        .tabs-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 0;
            border-radius: 12px 12px 0 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-bottom: none;
            scrollbar-width: none;
        }
        
        .tabs-container::-webkit-scrollbar {
            display: none;
        }
        
        .tabs {
            display: flex;
            min-width: max-content;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 16px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #555;
            transition: all 0.2s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
            flex-shrink: 0;
            border-bottom: 2px solid transparent;
        }
        
        .tab:hover {
            background: #f1f3f5;
        }
        
        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }
        
        .tab-icon {
            font-size: 1rem;
        }
        
        /* TAB CONTENT */
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            border-top: none;
            min-height: 300px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        h2 {
            color: #333;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        /* TABLE - Mobile optimized */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        th {
            background: #dc2626;
            color: white;
            padding: 14px 10px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 600;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        tr:hover {
            background: #fef2f2;
        }
        
        .result-win {
            background-color: #dcfce7;
            color: #166534;
            padding: 6px 10px;
            border-radius: 12px;
            font-weight: 600;
            border: 1px solid #bbf7d0;
            display: inline-block;
            font-size: 0.8rem;
        }
        
        .result-lose {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 6px 10px;
            border-radius: 12px;
            font-weight: 600;
            border: 1px solid #fecaca;
            display: inline-block;
            font-size: 0.8rem;
        }
        
        /* Colour dots */
        .colour-dots {
            display: flex;
            gap: 3px;
            align-items: center;
        }
        
        .colour-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .colour-red { background-color: #ff4444; }
        .colour-green { background-color: #44ff44; }
        .colour-violet { background-color: #aa44ff; }
        .colour-blue { background-color: #4444ff; }
        .colour-yellow { background-color: #ffff44; }
        .colour-orange { background-color: #ffaa44; }
        
        /* Loading & Empty States */
        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 1rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #e5e7eb;
            margin-bottom: 15px;
            display: block;
        }
        
        /* Last Update */
        .last-update {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .bot-icon {
            font-size: 1.4rem;
        }
        
        /* Scrollbar styling untuk mobile */
        .table-container::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #dc2626;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #b91c1c;
        }
        
        /* DESKTOP STYLES - hanya untuk layar lebih besar */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
            
            .container {
                max-width: 1400px;
            }
            
            .header {
                padding: 25px 20px;
                margin-bottom: 30px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2.2rem;
                margin-bottom: 10px;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .stat-card {
                padding: 25px 20px;
                border-radius: 12px;
                min-height: 130px;
            }
            
            .stat-card .value {
                font-size: 2.2rem;
            }
            
            .stat-card h3 {
                font-size: 0.95rem;
            }
            
            .summary {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .summary-item {
                padding: 20px 15px;
            }
            
            .summary-value {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 20px 25px;
                margin-bottom: 30px;
            }
            
            .filters {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                width: auto;
            }
            
            .filter-input {
                width: auto;
                min-width: 160px;
            }
            
            .btn {
                width: auto;
                padding: 12px 20px;
            }
            
            .tabs-container {
                overflow-x: visible;
            }
            
            .tabs {
                min-width: 100%;
            }
            
            .tab {
                flex: 1;
                min-width: 0;
                padding: 18px 20px;
            }
            
            .tab-content {
                padding: 25px;
                margin-bottom: 30px;
                min-height: 400px;
            }
            
            h2 {
                font-size: 1.5rem;
                margin-bottom: 25px;
            }
            
            .table-container {
                font-size: 0.9rem;
                max-height: 600px;
            }
            
            th {
                padding: 16px 12px;
                font-size: 0.9rem;
            }
            
            td {
                padding: 14px 12px;
                font-size: 0.9rem;
            }
            
            .result-win, .result-lose {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .colour-dot {
                width: 14px;
                height: 14px;
            }
            
            .last-update {
                text-align: right;
                padding: 15px;
            }
        }
        
        /* Untuk layar sangat kecil (di bawah 360px) */
        @media (max-width: 359px) {
            body {
                padding: 8px;
            }
            
            .stats-grid,
            .summary {
                grid-template-columns: 1fr;
            }
            
            .stat-card .value {
                font-size: 1.4rem;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .tab {
                padding: 14px 16px;
                font-size: 0.85rem;
            }
            
            .tab-icon {
                font-size: 0.9rem;
            }
            
            .pagination-controls {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .pagination-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            #pageInfo {
                min-width: 80px;
                font-size: 0.85rem;
            }
        }
        
        /* Untuk layar kecil (360px-480px) */
        @media (max-width: 480px) {
            .pagination-controls {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .pagination-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            #pageInfo {
                min-width: 80px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1><span class="bot-icon">üìä</span> WinGo Bot Analytics</h1>
            <p>Real-time monitoring bot trading WinGo</p>
        </div>
        
        <!-- STATISTIK UTAMA -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3><span>üé≤</span> Total Taruhan</h3>
                <div class="value" id="totalBets">0</div>
                <div class="subtext">Sejak bot mulai</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üìà</span> Win Rate</h3>
                <div class="value" id="winRate">0%</div>
                <div class="subtext">Persentase kemenangan</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üîÑ</span> Total Reset</h3>
                <div class="value" id="totalResets">0</div>
                <div class="subtext">Reset saldo</div>
            </div>
            
            <div class="stat-card">
                <h3><span>üí∞</span> Profit/Loss</h3>
                <div class="value" id="totalProfit">Rp 0</div>
                <div class="subtext">Total laba/rugi</div>
            </div>
        </div>
        
        <!-- SUMMARY -->
        <div class="summary">
            <div class="summary-item">
                <div class="summary-value" id="totalWins">0</div>
                <div class="summary-label">Kemenangan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="totalLosses">0</div>
                <div class="summary-label">Kekalahan</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="currentStreak">0</div>
                <div class="summary-label">Streak Saat Ini</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="avgBetAmount">Rp 0</div>
                <div class="summary-label">Rata-rata Taruhan</div>
            </div>
        </div>
        
        <!-- CONTROLS & FILTERS -->
        <div class="controls">
            <div class="filters">
                <input type="date" id="dateFilter" class="filter-input">
                <input type="text" id="searchFilter" class="filter-input" placeholder="Cari...">
                <button class="btn" onclick="refreshData()"><span>üîÑ</span> Refresh Data</button>
                <button class="btn" onclick="toggleSound()"><span>üîä</span> <span id="soundStatus">Suara: ON</span></button>
            </div>
            <div>
                <span id="connectionStatus" class="status-connected"><span>‚úÖ</span> Terhubung</span>
            </div>
        </div>
        
        <!-- TABS - Horizontal scroll di mobile -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="openTab(event, 'results')"><span class="tab-icon">üìã</span> Hasil Taruhan</button>
                <button class="tab" onclick="openTab(event, 'resets')"><span class="tab-icon">üîÑ</span> Data Reset</button>
                <button class="tab" onclick="openTab(event, 'reports')"><span class="tab-icon">üìä</span> Laporan Harian</button>
                <button class="tab" onclick="openTab(event, 'safety')"><span class="tab-icon">‚ö†Ô∏è</span> Safety Events</button>
                <button class="tab" onclick="openTab(event, 'balance')"><span class="tab-icon">üí∞</span> Perubahan Saldo</button>
            </div>
        </div>
        
        <!-- TAB CONTENT - Results -->
        <div id="results" class="tab-content active">
            <h2><span>üéØ</span> Data Hasil Taruhan</h2>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 0.9rem; color: #666;">
                    Total: <span id="totalRecords">0</span> data
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="pagination-btn" onclick="previousPage()" id="prevBtn" disabled>
                        ‚óÄ Prev
                    </button>
                    <span id="pageInfo">Halaman 1</span>
                    <button class="pagination-btn" onclick="nextPage()" id="nextBtn" disabled>
                        Next ‚ñ∂
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Periode</th>
                            <th>Angka</th>
                            <th>Colour</th>
                            <th>Hasil</th>
                            <th>Prediksi</th>
                            <th>Status</th>
                            <th>Level</th>
                            <th>Taruhan</th>
                            <th>P/L</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResults">Memuat data hasil taruhan...</div>
            <div class="empty-state" id="emptyResults" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada data hasil taruhan</p>
            </div>
        </div>
        
        <!-- TAB CONTENT - Resets -->
        <div id="resets" class="tab-content">
            <h2><span>üîÑ</span> Data Reset Saldo</h2>
            <div class="table-container">
                <table id="resetsTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Alasan</th>
                            <th>Saldo Lama</th>
                            <th>Saldo Baru</th>
                            <th>Total Bet</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="resetsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingResets">Memuat data reset...</div>
            <div class="empty-state" id="emptyResets" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada data reset</p>
            </div>
        </div>
        
        <!-- TAB CONTENT - Reports -->
        <div id="reports" class="tab-content">
            <h2><span>üìä</span> Laporan Harian</h2>
            <div class="table-container">
                <table id="reportsTable">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Total Taruhan</th>
                            <th>Menang</th>
                            <th>Kalah</th>
                            <th>Win Rate</th>
                            <th>Profit/Loss</th>
                            <th>Saldo Akhir</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="reportsBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingReports">Memuat laporan harian...</div>
            <div class="empty-state" id="emptyReports" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada laporan harian</p>
            </div>
        </div>
        
        <!-- TAB CONTENT - Safety -->
        <div id="safety" class="tab-content">
            <h2><span>‚ö†Ô∏è</span> Safety Events</h2>
            <div class="table-container">
                <table id="safetyTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Event</th>
                            <th>Detail</th>
                            <th>Saldo</th>
                            <th>Kalah Berturut</th>
                            <th>Level</th>
                        </tr>
                    </thead>
                    <tbody id="safetyBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingSafety">Memuat safety events...</div>
            <div class="empty-state" id="emptySafety" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada safety events</p>
            </div>
        </div>
        
        <!-- TAB CONTENT - Balance -->
        <div id="balance" class="tab-content">
            <h2><span>üí∞</span> Perubahan Saldo</h2>
            <div class="table-container">
                <table id="balanceTable">
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Jenis</th>
                            <th>Jumlah</th>
                            <th>Saldo Baru</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="balanceBody">
                        <!-- Data akan dimasukkan di sini -->
                    </tbody>
                </table>
            </div>
            <div class="loading" id="loadingBalance">Memuat perubahan saldo...</div>
            <div class="empty-state" id="emptyBalance" style="display: none;">
                <span>üì≠</span>
                <p>Tidak ada perubahan saldo</p>
            </div>
        </div>
        
        <!-- LAST UPDATE -->
        <div class="last-update">
            <strong>Terakhir diperbarui:</strong> <span id="lastUpdate">-</span>
        </div>
    </div>

    <!-- Audio untuk notifikasi -->
    <audio id="notificationSound" preload="auto">
        <source src="https://raw.githubusercontent.com/ojekaGorontalo/lotre/main/sound%2030%20detik.mp3" type="audio/mpeg">
    </audio>

    <script>
        // =========== PAGINATION VARIABLES ===========
        let currentPage = 1;
        const rowsPerPage = 10; // 10 data per halaman
        let totalFilteredResults = 0;
        let totalPages = 1;
        
        // =========== PAGINATION FUNCTIONS ===========
        function updatePaginationInfo() {
            const pageInfo = document.getElementById('pageInfo');
            const totalRecords = document.getElementById('totalRecords');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            totalRecords.textContent = totalFilteredResults;
            pageInfo.textContent = `Halaman ${currentPage} dari ${totalPages}`;
            
            // Enable/disable tombol
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            // Style tombol disabled
            if (prevBtn.disabled) {
                prevBtn.style.background = '#f3f4f6';
                prevBtn.style.color = '#9ca3af';
                prevBtn.style.borderColor = '#e5e7eb';
            } else {
                prevBtn.style.background = '';
                prevBtn.style.color = '';
                prevBtn.style.borderColor = '';
            }
            
            if (nextBtn.disabled) {
                nextBtn.style.background = '#f3f4f6';
                nextBtn.style.color = '#9ca3af';
                nextBtn.style.borderColor = '#e5e7eb';
            } else {
                nextBtn.style.background = '';
                nextBtn.style.color = '';
                nextBtn.style.borderColor = '';
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                displayResults();
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayResults();
            }
        }
        
        function goToPage(pageNumber) {
            if (pageNumber >= 1 && pageNumber <= totalPages) {
                currentPage = pageNumber;
                displayResults();
            }
        }
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwepdohDnAFm7j9yGZ3Wan5etfMlYIY4w",
            authDomain: "wingo-bot-analytics.firebaseapp.com",
            databaseURL: "https://wingo-bot-analytics-default-rtdb.firebaseio.com",
            projectId: "wingo-bot-analytics",
            storageBucket: "wingo-bot-analytics.appspot.com",
            messagingSenderId: "46011860748",
            appId: "1:46011860748:web:f5d61b92de5201a6ed818e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let allResults = [];
        let allResets = [];
        let allReports = [];
        let allSafetyEvents = [];
        let allBalanceChanges = [];
        let lastResultTimestamp = 0;
        let soundEnabled = true;
        let previousResultsCount = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            
            // Auto refresh every 30 seconds
            setInterval(loadAllData, 30000);
        });

        // Load all data from Firebase
        function loadAllData() {
            console.log('Memuat data dari Firebase...');
            
            // Store current results count before loading
            previousResultsCount = allResults.length;
            
            // Load results
            database.ref('results').orderByChild('timestamp').limitToLast(1000).on('value', (snapshot) => {
                allResults = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResults.unshift(data); // Newest first
                });
                
                // Check for new data and play sound if enabled
                if (soundEnabled && allResults.length > 0 && allResults.length > previousResultsCount) {
                    // Get the newest result
                    const latestResult = allResults[0];
                    const latestTimestamp = latestResult.timestamp;
                    
                    // Only play sound if we have a previous timestamp and new data arrived
                    if (lastResultTimestamp > 0 && latestTimestamp > lastResultTimestamp) {
                        playNotificationSound();
                    }
                    
                    // Update lastResultTimestamp
                    lastResultTimestamp = latestTimestamp;
                } else if (allResults.length > 0 && lastResultTimestamp === 0) {
                    // First load, set the timestamp but don't play sound
                    lastResultTimestamp = allResults[0].timestamp;
                }
                
                displayResults();
                updateStats();
            }, (error) => {
                console.error('Error loading results:', error);
                showConnectionError();
            });

            // Load resets
            database.ref('resets').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allResets = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allResets.unshift(data);
                });
                displayResets();
                updateStats();
            }, (error) => {
                console.error('Error loading resets:', error);
                showConnectionError();
            });

            // Load reports
            database.ref('daily_reports').orderByChild('timestamp').limitToLast(30).on('value', (snapshot) => {
                allReports = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allReports.unshift(data);
                });
                displayReports();
            }, (error) => {
                console.error('Error loading reports:', error);
                showConnectionError();
            });

            // Load safety events
            database.ref('safety_events').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allSafetyEvents = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allSafetyEvents.unshift(data);
                });
                displaySafetyEvents();
            }, (error) => {
                console.error('Error loading safety events:', error);
                showConnectionError();
            });

            // Load balance changes
            database.ref('balance_changes').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                allBalanceChanges = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    data.id = childSnapshot.key;
                    allBalanceChanges.unshift(data);
                });
                displayBalanceChanges();
            }, (error) => {
                console.error('Error loading balance changes:', error);
                showConnectionError();
            });

            // Update last update time
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('id-ID');
            document.getElementById('connectionStatus').innerHTML = '<span>‚úÖ</span> Terhubung';
            document.getElementById('connectionStatus').className = 'status-connected';
        }

        // Play notification sound
        function playNotificationSound() {
            const audio = document.getElementById('notificationSound');
            if (audio) {
                audio.currentTime = 0; // Reset audio to start
                audio.play().catch(e => {
                    console.log("Gagal memutar suara: ", e);
                    // If autoplay is blocked, show notification
                    showNotification("Data baru tersedia!");
                });
                
                // Also show visual notification
                flashHeader();
            }
        }

        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundStatus = document.getElementById('soundStatus');
            soundStatus.textContent = soundEnabled ? 'Suara: ON' : 'Suara: OFF';
            
            // Change button color
            const button = soundStatus.closest('.btn');
            if (soundEnabled) {
                button.style.background = '#dc2626';
            } else {
                button.style.background = '#666';
            }
            
            // Show notification
            showNotification(`Suara notifikasi ${soundEnabled ? 'diaktifkan' : 'dimatikan'}`);
        }

        // Show temporary notification
        function showNotification(message) {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('tempNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'tempNotification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #dc2626;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 1000;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    opacity: 0;
                    transition: opacity 0.3s;
                `;
                document.body.appendChild(notification);
            }
            
            notification.innerHTML = `<span>üîî</span> ${message}`;
            notification.style.opacity = '1';
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Flash header to indicate new data
        function flashHeader() {
            const header = document.querySelector('.header');
            const originalBg = header.style.background;
            
            // Flash animation
            header.style.animation = 'none';
            setTimeout(() => {
                header.style.animation = 'flash 0.5s ease';
            }, 10);
            
            // Create flash animation
            if (!document.querySelector('#flashAnimation')) {
                const style = document.createElement('style');
                style.id = 'flashAnimation';
                style.textContent = `
                    @keyframes flash {
                        0% { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
                        50% { background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); }
                        100% { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Fungsi untuk render colour dots
        function renderColourDots(colourStr) {
            if (!colourStr) return '-';
            
            const colours = colourStr.split(',').map(c => c.trim().toLowerCase());
            let html = '<div class="colour-dots">';
            
            colours.forEach(colour => {
                let colourClass = 'colour-' + colour;
                // Pastikan hanya warna yang valid
                const validColours = ['red', 'green', 'violet', 'blue', 'yellow', 'orange'];
                if (!validColours.includes(colour)) {
                    colourClass = 'colour-blue'; // Default jika warna tidak dikenal
                }
                html += `<div class="colour-dot ${colourClass}" title="${colour}"></div>`;
            });
            
            html += '</div>';
            return html;
        }

        // =========== MODIFIED displayResults FUNCTION ===========
        function displayResults() {
            const tbody = document.getElementById('resultsBody');
            const loading = document.getElementById('loadingResults');
            const empty = document.getElementById('emptyResults');
            
            if (allResults.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                totalFilteredResults = 0;
                updatePaginationInfo();
                return;
            }
            
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            
            // Filter data
            const filteredData = allResults.filter(result => {
                // Filter tanggal
                if (dateFilter) {
                    const resultDate = new Date(result.timestamp).toISOString().split('T')[0];
                    if (resultDate !== dateFilter) return false;
                }
                
                // Filter pencarian
                if (searchTerm) {
                    const searchText = `${result.result || ''} ${result.prediction || ''} ${result.issue || ''} ${result.colour || ''}`.toLowerCase();
                    if (!searchText.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            totalFilteredResults = filteredData.length;
            totalPages = Math.max(1, Math.ceil(totalFilteredResults / rowsPerPage));
            
            // Reset ke halaman 1 jika currentPage melebihi totalPages
            if (currentPage > totalPages) {
                currentPage = 1;
            }
            
            // Pagination: Ambil data untuk halaman saat ini
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            
            if (pageData.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                updatePaginationInfo();
                return;
            }
            
            // Render data halaman saat ini
            let html = '';
            pageData.forEach(result => {
                const isWin = result.isWin;
                const statusClass = isWin ? 'result-win' : 'result-lose';
                const statusText = isWin ? 'MENANG' : 'KALAH';
                const profitLoss = result.profitLoss || 0;
                const colourDots = renderColourDots(result.colour);
                
                // Format waktu
                const resultTime = new Date(result.timestamp).toLocaleTimeString('id-ID', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                html += `
                <tr>
                    <td>${resultTime}</td>
                    <td>${result.issue || '-'}</td>
                    <td><strong>${result.number !== undefined && result.number !== null ? result.number : '-'}</strong></td>
                    <td>${colourDots}</td>
                    <td>${result.result || '-'}</td>
                    <td>${result.prediction || '-'}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>${result.betLevel || '-'}</td>
                    <td>Rp ${formatNumber(result.betAmount || 0)}</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(result.virtualBalance || 0)}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
            
            // Update info pagination
            updatePaginationInfo();
        }

        // Display resets in table
        function displayResets() {
            const tbody = document.getElementById('resetsBody');
            const loading = document.getElementById('loadingResets');
            const empty = document.getElementById('emptyResets');
            
            if (allResets.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allResets.forEach(reset => {
                const resetTime = new Date(reset.timestamp || reset.resetTime).toLocaleString('id-ID');
                
                html += `
                <tr>
                    <td>${resetTime}</td>
                    <td>${reset.reason || 'Tidak diketahui'}</td>
                    <td>Rp ${formatNumber(reset.oldBalance || 0)}</td>
                    <td>Rp ${formatNumber(reset.newBalance || 0)}</td>
                    <td>${reset.totalBetsBeforeReset || 0}</td>
                    <td>${reset.currentBetIndex + 1 || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display reports in table
        function displayReports() {
            const tbody = document.getElementById('reportsBody');
            const loading = document.getElementById('loadingReports');
            const empty = document.getElementById('emptyReports');
            
            if (allReports.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allReports.forEach(report => {
                // Pastikan format tanggal benar
                const reportDate = report.date ? 
                    new Date(report.date).toLocaleDateString('id-ID') : 
                    new Date(report.timestamp).toLocaleDateString('id-ID');
                
                // Hitung statistik dari data yang ada
                const totalBets = report.totalBets || 0;
                const totalWins = report.totalWins || 0;
                const totalLosses = report.totalLosses || 0;
                const winRate = totalBets > 0 ? Math.round((totalWins / totalBets) * 100) : 0;
                const profitLoss = report.profitLoss || 0;
                const virtualBalance = report.virtualBalance || 0;
                const currentBetLevel = report.currentBetLevel || 1;
                
                html += `
                <tr>
                    <td>${reportDate}</td>
                    <td>${totalBets}</td>
                    <td>${totalWins}</td>
                    <td>${totalLosses}</td>
                    <td>${winRate}%</td>
                    <td>Rp ${formatNumber(profitLoss)}</td>
                    <td>Rp ${formatNumber(virtualBalance)}</td>
                    <td>${currentBetLevel}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display safety events in table
        function displaySafetyEvents() {
            const tbody = document.getElementById('safetyBody');
            const loading = document.getElementById('loadingSafety');
            const empty = document.getElementById('emptySafety');
            
            if (allSafetyEvents.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allSafetyEvents.forEach(event => {
                const eventTime = new Date(event.timestamp).toLocaleString('id-ID');
                const details = event.details ? JSON.stringify(event.details) : '-';
                
                html += `
                <tr>
                    <td>${eventTime}</td>
                    <td>${event.event || '-'}</td>
                    <td title="${details}">${truncateText(details, 50)}</td>
                    <td>Rp ${formatNumber(event.virtualBalance || 0)}</td>
                    <td>${event.losingStreak || 0}</td>
                    <td>${event.currentBetLevel || 1}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Display balance changes in table
        function displayBalanceChanges() {
            const tbody = document.getElementById('balanceBody');
            const loading = document.getElementById('loadingBalance');
            const empty = document.getElementById('emptyBalance');
            
            if (allBalanceChanges.length === 0) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                tbody.innerHTML = '';
                return;
            }
            
            let html = '';
            
            allBalanceChanges.forEach(change => {
                const changeTime = new Date(change.timestamp).toLocaleString('id-ID');
                const type = change.type === 'manual_add_balance' ? 'Tambah Manual' : 
                            change.type === 'reset' ? 'Reset' : 
                            change.type === 'bet' ? 'Taruhan' :
                            change.type === 'win' ? 'Menang' :
                            change.type === 'loss' ? 'Kalah' : 'Lainnya';
                
                html += `
                <tr>
                    <td>${changeTime}</td>
                    <td>${type}</td>
                    <td>Rp ${formatNumber(change.amount || 0)}</td>
                    <td>Rp ${formatNumber(change.newBalance || 0)}</td>
                    <td>${change.reason || '-'}</td>
                </tr>
                `;
            });
            
            tbody.innerHTML = html;
            loading.style.display = 'none';
            empty.style.display = 'none';
        }

        // Update statistics
        function updateStats() {
            if (allResults.length === 0) {
                // Set default values
                document.getElementById('totalBets').textContent = '0';
                document.getElementById('totalWins').textContent = '0';
                document.getElementById('totalLosses').textContent = '0';
                document.getElementById('winRate').textContent = '0%';
                document.getElementById('totalResets').textContent = allResets.length;
                document.getElementById('totalProfit').textContent = 'Rp 0';
                document.getElementById('currentStreak').textContent = '0';
                document.getElementById('avgBetAmount').textContent = 'Rp 0';
                return;
            }
            
            // Total bets
            document.getElementById('totalBets').textContent = allResults.length;
            
            // Calculate wins and losses
            const wins = allResults.filter(r => r.isWin).length;
            const losses = allResults.filter(r => !r.isWin).length;
            const winRate = allResults.length > 0 ? Math.round((wins / allResults.length) * 100) : 0;
            
            document.getElementById('totalWins').textContent = wins;
            document.getElementById('totalLosses').textContent = losses;
            document.getElementById('winRate').textContent = winRate + '%';
            
            // Total resets
            document.getElementById('totalResets').textContent = allResets.length;
            
            // Calculate total profit/loss from the LATEST result (kumulatif)
            let totalProfit = 0;
            if (allResults.length > 0) {
                // Ambil profitLoss dari hasil terbaru (sudah kumulatif)
                const latestResult = allResults[0];
                totalProfit = latestResult.profitLoss || 0;
            }
            
            document.getElementById('totalProfit').textContent = 'Rp ' + formatNumber(totalProfit);
            
            // Current streak (from latest result)
            const latestResult = allResults[0];
            if (latestResult) {
                document.getElementById('currentStreak').textContent = latestResult.currentStreak || 0;
            }
            
            // Average bet amount
            const totalBetAmount = allResults.reduce((sum, result) => sum + (result.betAmount || 0), 0);
            const avgBetAmount = allResults.length > 0 ? Math.round(totalBetAmount / allResults.length) : 0;
            document.getElementById('avgBetAmount').textContent = 'Rp ' + formatNumber(avgBetAmount);
        }

        // Tab switching function
        function openTab(evt, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show current tab and add active class
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // Format number with thousand separators
        function formatNumber(num) {
            if (num === undefined || num === null) return "0";
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Truncate text
        function truncateText(text, maxLength) {
            if (!text || text === '-') return '-';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // =========== MODIFIED refreshData FUNCTION ===========
        function refreshData() {
            console.log('Manual refresh...');
            currentPage = 1; // Reset ke halaman 1 saat refresh
            document.getElementById('connectionStatus').innerHTML = '<span>‚è≥</span> Memuat ulang...';
            document.getElementById('connectionStatus').className = 'status-disconnected';
            
            // Show loading states
            const loadings = document.querySelectorAll('.loading');
            loadings.forEach(loading => {
                loading.style.display = 'block';
            });
            
            const empties = document.querySelectorAll('.empty-state');
            empties.forEach(empty => {
                empty.style.display = 'none';
            });
            
            // Reload data after a short delay
            setTimeout(() => {
                loadAllData();
            }, 500);
        }

        // Show connection error
        function showConnectionError() {
            document.getElementById('connectionStatus').innerHTML = '<span>‚ùå</span> Gagal menghubungi database';
            document.getElementById('connectionStatus').className = 'status-disconnected';
        }

        // =========== MODIFIED FILTER EVENT LISTENERS ===========
        document.getElementById('dateFilter').addEventListener('change', function() {
            currentPage = 1; // Reset ke halaman 1 saat filter berubah
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        document.getElementById('searchFilter').addEventListener('input', function() {
            currentPage = 1; // Reset ke halaman 1 saat search berubah
            if (document.getElementById('results').classList.contains('active')) {
                displayResults();
            }
        });

        // Add keyboard shortcut for refresh (Ctrl+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
            // Add keyboard shortcut for toggling sound (Ctrl+S)
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                toggleSound();
            }
            // Panah kiri untuk previous page
            if (e.key === 'ArrowLeft' && !e.ctrlKey) {
                e.preventDefault();
                previousPage();
            }
            // Panah kanan untuk next page
            if (e.key === 'ArrowRight' && !e.ctrlKey) {
                e.preventDefault();
                nextPage();
            }
            // Home untuk halaman 1
            if (e.key === 'Home') {
                e.preventDefault();
                goToPage(1);
            }
            // End untuk halaman terakhir
            if (e.key === 'End') {
                e.preventDefault();
                goToPage(totalPages);
            }
        });

        // Set today's date as default in date filter
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFilter').value = today;
        };
    </script>
</body>
</html>
